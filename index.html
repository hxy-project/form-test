<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>多表单复制粘贴</title>
  <style>
    .modal { display: none; position: fixed; background: rgba(0,0,0,0.5); top: 0; left: 0; width: 100%; height: 100%; }
    .modal-content { background: #fff; margin: 100px auto; padding: 20px; width: 300px; }
  </style>
</head>
<body>

<!-- 多个表单 -->
<form data-form-id="form1">
  <h3>表单1</h3>
  姓名：<input name="name"><br>
  邮箱：<input name="email"><br>
</form>

<form data-form-id="form2">
  <h3>表单2</h3>
  电话：<input name="phone"><br>
  地址：<input name="address"><br>
</form>

<!-- 操作按钮 -->
<button id="openModal">复制选项</button>
<button id="pasteBtn">粘贴内容</button>

<!-- 弹窗 -->
<div class="modal" id="selectModal">
  <div class="modal-content">
    <h4>选择要复制的表单</h4>
    <label><input type="checkbox" class="form-checkbox" value="form1" checked> 表单1</label><br>
    <label><input type="checkbox" class="form-checkbox" value="form2" checked> 表单2</label><br><br>
    <button id="confirmCopy">确认复制</button>
    <button onclick="document.getElementById('selectModal').style.display='none'">关闭</button>
  </div>
</div>

<script>
  // 打开复制弹窗
  document.getElementById('openModal').onclick = () => {
    document.getElementById('selectModal').style.display = 'block';
  };

  // 点击确认复制
  document.getElementById('confirmCopy').onclick = async () => {
    const checked = Array.from(document.querySelectorAll('.form-checkbox:checked'))
      .map(checkbox => checkbox.value);

    let allFormData = {};

    checked.forEach(id => {
      const form = document.querySelector(`form[data-form-id="${id}"]`);
      const data = new FormData(form);
      const obj = {};
      for (const [key, value] of data.entries()) {
        obj[key] = value;
      }
      allFormData[id] = obj;
    });

    const clipboardText = JSON.stringify(allFormData);
    await navigator.clipboard.writeText(clipboardText);
    alert("内容已复制到剪贴板，并尝试填入空白表单。");

    autoFillForms(allFormData); // 当前页面尝试填空字段
    document.getElementById('selectModal').style.display = 'none';
  };

  // 点击粘贴按钮，从剪贴板粘贴内容
  document.getElementById('pasteBtn').onclick = async () => {
    try {
      const text = await navigator.clipboard.readText();
      const data = JSON.parse(text);
      autoFillForms(data);
      alert("内容已从剪贴板粘贴到空表单字段");
    } catch (err) {
      alert("粘贴失败：请确保剪贴板中是有效的表单数据");
    }
  };

  // 填充空字段的逻辑
  function autoFillForms(data) {
    Object.entries(data).forEach(([formId, formData]) => {
      const form = document.querySelector(`form[data-form-id="${formId}"]`);
      if (!form) return;

      Object.entries(formData).forEach(([key, value]) => {
        const input = form.querySelector(`[name="${key}"]`);
        if (input && input.value === "") {
          input.value = value;
        }
      });
    });
  }
</script>

</body>
</html>
